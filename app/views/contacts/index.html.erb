<%= link_to l(:add_contact), new_project_contact_path(project_id: @project.id), class: 'icon icon-add' %>

<div >
  <table>
    <tr>
      <td class="field"><%= l(:field_column_names) %></td>
      <td><%= render_query_columns_selection(@query) %></td>
    </tr>
    <tr>
      <td class="field"><label for='group_by'><%= l(:field_group_by) %></label></td>
      <td><%= select_tag('group_by',
                         options_for_select(
                             [[]] + @query.groupable_columns.collect {|c| [c.caption, c.name.to_s]},
                             @query.group_by)
              ) %></td>
    </tr>
    <tr>
      <td class="field"><%= l(:button_show) %></td>
      <td><%= available_block_columns_tags(@query) %></td>
    </tr>
    <tr>
      <td><%= l(:label_total_plural) %></td>
      <td><%= available_totalable_columns_tags(@query) %></td>
    </tr>
  </table>
</div>



<table class="list issues <%= sort_css_classes %>">
  <thead>
  <tr>
    <th class="checkbox hide-when-print">
      <%= check_box_tag 'check_all', '', false, :class => 'toggle-selection',
                        :title => "#{l(:button_check_all)}/#{l(:button_uncheck_all)}" %>
    </th>
    <% @query.inline_columns.each do |column| %>
        <%= column_header(column) %>
    <% end %>
  </tr>
  </thead>
  <tbody>
  <% grouped_issue_list(@contacts, @query, 0) do |issue, level, group_name, group_count, group_totals| -%>
      <% if group_name %>
          <% reset_cycle %>
          <tr class="group open">
            <td colspan="<%= @query.inline_columns.size + 1 %>">
              <span class="expander" onclick="toggleRowGroup(this);">&nbsp;</span>
              <span class="name"><%= group_name %></span> <span class="count"><%= group_count %></span> <span class="totals"><%= group_totals %></span>
              <%= link_to_function("#{l(:button_collapse_all)}/#{l(:button_expand_all)}",
                                   "toggleAllRowGroups(this)", :class => 'toggle-all') %>
            </td>
          </tr>
      <% end %>
      <tr id="issue-<%= issue.id %>" class="hascontextmenu <%= cycle('odd', 'even') %> <%#= issue.css_classes %> <%= level > 0 ? "idnt idnt-#{level}" : nil %>">
        <td class="checkbox hide-when-print"><%= check_box_tag("ids[]", issue.id, false, :id => nil) %></td>
        <%= raw @query.inline_columns.map {|column| "<td class=\"#{column.css_classes}\">#{column_content(column, issue)}</td>"}.join %>
      </tr>
      <% @query.block_columns.each do |column|
        if (text = column_content(column, issue)) && text.present? -%>
              <tr class="<%= current_cycle %>">
                <td colspan="<%= @query.inline_columns.size + 1 %>" class="<%= column.css_classes %>"><%= text %></td>
              </tr>
          <% end -%>
      <% end -%>
  <% end -%>
  </tbody>
</table>


--------------------------------------------------------------------------------------------------------------
<% @contacts.each do |contact| %>
    <p>
      <%= contact.name %>
      <%= contact.about %>

      <% contact.custom_values.each do |custom_value| %>
          <% if !custom_value.value.blank? %>
            <li><%= custom_value.custom_field.name%>: <%=h show_value(custom_value) %></li>
        <% end %>
    <% end %>

      <%= render :partial => 'attachments/links',
      :locals  => { :attachments => contact.attachments,
      :options => { :deletable => User.current.logged? }
      } %>

    <td><%= link_to l(:edit), edit_project_contact_path(@project, contact), class: 'icon icon-edit' %></td>
    <td><%= link_to l(:delete), [@project, contact], method: :delete, data: { confirm: l(:are_you_sure) }, class: 'icon icon-del' %></td>
    </p>
<% end %>